# 完整ECG波形标注可视化工具

## 功能描述

这个脚本可以生成完整的ECG波形图，并在图上标注所有的标注点位置。生成的图形具有以下特点：

1. **完整长度**：显示整个记录的ECG波形，无长度限制
2. **高清晰度**：采用高DPI输出，确保波形细节清晰可见
3. **全面标注**：标注所有类型的标注点，并用不同颜色区分
4. **统计报告**：生成详细的标注统计报告
5. **多格式输出**：同时保存PNG和PDF格式

## 使用方法

### 基本使用

```python
# 运行脚本
python SaveEntireWave.py
```

### 自定义配置

在脚本中修改以下参数：

```python
# 选择要处理的记录
numberSet = ['100', '101', '103']  # 添加更多记录号

# 选择导联
channels = ['MLII', 'V1', 'V5']  # 处理多个导联

# 自定义输出路径
output_dir = './my_ecg_plots/'
```

## 输出文件

脚本会在指定目录生成以下文件：

1. **PNG图像**：`{记录号}_{导联}_complete_ecg.png`
   - 高分辨率图像，适合屏幕查看

2. **PDF文件**：`{记录号}_{导联}_complete_ecg.pdf`
   - 矢量格式，可无限缩放而不失真

3. **统计报告**：`{记录号}_annotation_report.txt`
   - 包含所有标注类型的详细统计

## 标注类型说明

| 标注 | 颜色 | 描述 |
|------|------|------|
| N | 绿色 | Normal (正常心跳) |
| V | 红色 | Ventricular Premature (室性早搏) |
| A | 橙色 | Atrial Premature (房性早搏) |
| L | 紫色 | Left Bundle Branch Block (左束支传导阻滞) |
| R | 蓝色 | Right Bundle Branch Block (右束支传导阻滞) |
| / | 灰色 | Paced Beat (起搏心跳) |
| ~ | 棕色 | Signal Quality Change (信号质量变化) |
| + | 粉色 | Rhythm Change (心律变化) |
| ... | ... | 其他类型 |

## 图形特点

1. **动态尺寸**：图形宽度根据信号长度自动调整
2. **清晰标注**：每个标注点都有垂直线和标记点
3. **完整图例**：显示所有标注类型的颜色说明
4. **时间轴**：X轴显示实际时间（秒）
5. **网格背景**：便于观察波形细节

## 系统要求

```bash
pip install wfdb pywavelets scipy matplotlib numpy torch
```

## 注意事项

1. **内存使用**：处理长记录时需要足够内存
2. **输出大小**：生成的图像文件可能很大
3. **处理时间**：处理大量记录需要较长时间
4. **磁盘空间**：确保有足够磁盘空间保存输出文件

## 故障排除

### 常见问题

1. **matplotlib导入错误**
   ```bash
   pip install matplotlib
   ```

2. **内存不足**
   - 减少同时处理的记录数量
   - 使用较短的记录进行测试

3. **图形显示问题**
   - 使用PDF格式查看更高质量的图像
   - 调整DPI设置

4. **权限错误**
   - 确保有写入输出目录的权限

## 示例输出

处理记录100的MLII导联将生成：
- `100_MLII_complete_ecg.png` - 主图像文件
- `100_MLII_complete_ecg.pdf` - PDF格式文件
- `100_annotation_report.txt` - 统计报告

图像将显示：
- 完整的30分钟ECG波形
- 约2270个标注点
- 不同颜色的垂直线表示不同类型的心律事件
- 详细的图例说明

## 扩展功能

可以进一步扩展脚本以支持：
1. 批量处理整个数据库
2. 生成波形片段的放大视图
3. 添加心率变化曲线
4. 支持更多数据库格式
5. 生成交互式HTML报告